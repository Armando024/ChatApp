<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Socket.IO chat</title>
    <style>
      .UserTyping {background: #fff !important;}
      .Notification{width:70%; margin:auto; }
      .footer{position:fixed;bottom:0;width:100%}
    </style>
  </head>
  <body>
      <!--  <ul id="messages"></ul>-->
      <div class="container pt-3">
          <div class="row">
              <div class="col-md-10">
                  <div id="messages" class="row">
                  </div>
              </div>
              <div class="col-md-2">
                  <h4>Active</h4>
                  <ul>
                  </ul>
              </div>
          </div>
      <div>
    <form action="">
        <div class="footer">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div id="usrtyping" class="UserTyping" style="display:none;"><p>Someone is typing...</p> </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8 col-4 pr-0 mr-0">
                            <input id="m" autocomplete="off" class="form-control" />
                        </div>
                        <div class="col-md-3 pl-0 ml-0">
                            <button class="btn btn-primary">Send</button>
                        </div>
                    </div>
                </div>
        </div>
    </form>
    <script src="/socket.io/socket.io.js"></script>
<script  src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script>
        
        $(function () {
            var socket = io();
            var a=window.location.pathname;
            console.log(a);
            console.log(a.split('/'));
            a=a.split('/');
            var usrname=a[2];
            socket.emit('User Connects',a[2]);
            $('form').submit(function(){
                socket.emit('chat message', $('#m').val(),usrname);
                $('#m').val('');
                $('#usrtyping').hide();
                return false;
            });
            $('#m').keyup(function(){
                if ($('#m').val()==''){
                    socket.emit('user NOTtyping');
                }
            });
            $('#m').keydown(function(){
                socket.emit('user typing');
            });

            socket.on('chat message', function(msg,usrname){
                $('#messages').append($('<div class="col-md-12">').text(usrname+': '+ msg));
            });

            socket.on('user typing',function(){
                //$('#messages').append($('<li>').text('someone is typing'));
                $('#usrtyping').show();
            });

            socket.on('user NOTtyping',function(){
                //$('#messages').append($('<li>').text('someone is typing'));
                $('#usrtyping').hide();
            });
            socket.on('User Connects',function(usrname){
                $('#messages').append($('<div class="col-md-12 text-center  alert alert-success">').text(usrname+' Connected '));
            });
            socket.on('User disconnected',function(usr){
                $('#messages').append($('<div class="col-md-12 text-center alert alert-danger">').text(usr+' disconnected'));
            });
        });

</script>
  </body>
</html>
